<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <!-- ==================== FORM VIEW MODERN - ƒê·∫∂T PH√íNG H·ªåP ==================== -->
        <record id="view_meeting_room_booking_form_modern" model="ir.ui.view">
            <field name="name">meeting.room.booking.form.modern</field>
            <field name="model">meeting.room.booking</field>
            <field name="priority">5</field>
            <field name="arch" type="xml">
                <form class="o_booking_form">
                    <header>
                        <!-- N√∫t Check-in -->
                        <button name="action_check_in" string="üìç Check-in" 
                                type="object" class="btn-primary" 
                                attrs="{'invisible': [('state', '!=', 'confirmed')]}"/>
                        
                        <!-- N√∫t Check-out -->
                        <button name="action_check_out" string="‚úì Check-out" 
                                type="object" class="btn-success" 
                                attrs="{'invisible': [('state', '!=', 'in_progress')]}"/>
                        
                        <!-- N√∫t G·ª£i √Ω ph√≤ng kh√°c -->
                        <button name="action_suggest_alternatives" string="üîç G·ª£i √Ω ph√≤ng" 
                                type="object" class="btn-info"
                                attrs="{'invisible': [('has_conflict', '=', False)]}"/>
                        
                        <!-- N√∫t H·ªßy -->
                        <button name="action_cancel" string="H·ªßy ƒë·∫∑t ph√≤ng" 
                                type="object" class="btn-danger"
                                attrs="{'invisible': [('state', 'in', ['completed', 'cancelled'])]}"/>
                        
                        <field name="state" widget="statusbar" 
                               statusbar_visible="draft,confirmed,in_progress,completed"/>
                    </header>
                    
                    <sheet>
                        <!-- Hidden fields -->
                        <field name="has_conflict" invisible="1"/>
                        <field name="conflict_count" invisible="1"/>
                        <field name="require_approval" invisible="1"/>
                        <field name="room_location_id" invisible="1"/>
                        
                        <!-- C·∫£nh b√°o xung ƒë·ªôt -->
                        <div class="alert alert-danger mb-3" role="alert" 
                             attrs="{'invisible': [('has_conflict', '=', False)]}">
                            <h4 class="alert-heading">‚ö†Ô∏è C·∫£nh b√°o xung ƒë·ªôt l·ªãch!</h4>
                            <p>C√≥ <field name="conflict_count" class="oe_inline"/> booking kh√°c xung ƒë·ªôt th·ªùi gian.</p>
                            <hr/>
                            <button name="action_suggest_alternatives" 
                                    string="Xem ph√≤ng c√≤n tr·ªëng" 
                                    type="object" class="btn btn-outline-danger"/>
                        </div>
                        
                        <!-- Th√¥ng b√°o x√°c nh·∫≠n -->
                        <div class="alert alert-success mb-3" role="alert" 
                             attrs="{'invisible': [('state', '!=', 'confirmed')]}">
                            <strong>‚úÖ ƒê·∫∑t ph√≤ng ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n!</strong>
                            Vui l√≤ng ƒë·∫øn check-in ƒë√∫ng gi·ªù.
                        </div>
                        
                        <div class="oe_title">
                            <label for="name"/>
                            <h1><field name="name" readonly="1" class="oe_inline"/></h1>
                        </div>
                        
                        <group>
                            <group string="üìã Th√¥ng tin cu·ªôc h·ªçp">
                                <field name="subject" placeholder="Nh·∫≠p ch·ªß ƒë·ªÅ cu·ªôc h·ªçp..." 
                                       attrs="{'required': [('state', '!=', 'cancelled')]}"/>
                                <field name="room_id" options="{'no_create': True}"
                                       domain="[('state', '=', 'available')]"/>
                                <field name="expected_attendees" 
                                       widget="integer"
                                       attrs="{'required': [('state', '!=', 'cancelled')]}"/>
                                <field name="description" placeholder="M√¥ t·∫£ m·ª•c ƒë√≠ch cu·ªôc h·ªçp..."/>
                            </group>
                            <group string="‚è∞ Th·ªùi gian">
                                <field name="start_time" 
                                       attrs="{'required': [('state', '!=', 'cancelled')]}"/>
                                <field name="end_time" 
                                       attrs="{'required': [('state', '!=', 'cancelled')]}"/>
                                <field name="duration" widget="float_time" readonly="1"/>
                            </group>
                        </group>
                        
                        <group>
                            <group string="üë§ Ng∆∞·ªùi li√™n quan">
                                <field name="booker_id"/>
                                <field name="organizer_id"/>
                            </group>
                            <group string="üìç Check-in/Check-out">
                                <field name="check_in_time" readonly="1"/>
                                <field name="check_out_time" readonly="1"/>
                                <field name="auto_cancel_if_no_checkin"/>
                            </group>
                        </group>
                        
                        <notebook>
                            <page string="üë• Ng∆∞·ªùi tham d·ª±" name="attendees">
                                    <field name="attendee_ids" widget="many2many_tags"/>
                            </page>
                            
                            <page string="üñ•Ô∏è Thi·∫øt b·ªã y√™u c·∫ßu" name="equipment">
                                <group>
                                    <field name="equipment_ids" 
                                           widget="many2many_tags"
                                           domain="[('location_id', '=', room_location_id), ('state', '=', 'available')]"
                                           context="{'default_location_id': room_location_id}"/>
                                </group>
                                <group>
                                    <field name="equipment_notes" 
                                           placeholder="Ghi ch√∫ v·ªÅ thi·∫øt b·ªã c·∫ßn d√πng (TV, m√°y chi·∫øu, micro,...)"/>
                                </group>
                                <group>
                                    <field name="equipment_prepared" widget="boolean_toggle"/>
                                    <field name="equipment_checked_by" readonly="1"/>
                                    <field name="equipment_checked_date" readonly="1"/>
                                </group>
                            </page>
                            
                            <page string="üìä Ph√™ duy·ªát" name="approval" 
                                  attrs="{'invisible': [('require_approval', '=', False)]}">
                                <group>
                                    <field name="approval_level" readonly="1"/>
                                    <field name="approved_by_id" readonly="1"/>
                                    <field name="approved_date" readonly="1"/>
                                    <field name="rejection_reason" readonly="1"/>
                                </group>
                            </page>
                            
                            <page string="‚≠ê ƒê√°nh gi√°" name="feedback" 
                                  attrs="{'invisible': [('state', '!=', 'completed')]}">
                                <group>
                                    <field name="actual_attendees"/>
                                    <field name="rating" widget="priority"/>
                                    <field name="feedback" placeholder="Ph·∫£n h·ªìi v·ªÅ cu·ªôc h·ªçp..."/>
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                    
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <!-- ==================== KANBAN VIEW MODERN ==================== -->
        <record id="view_meeting_room_booking_kanban_modern" model="ir.ui.view">
            <field name="name">meeting.room.booking.kanban.modern</field>
            <field name="model">meeting.room.booking</field>
            <field name="priority">5</field>
            <field name="arch" type="xml">
                <kanban default_group_by="state" class="o_kanban_small_column o_opportunity_kanban">
                    <field name="name"/>
                    <field name="subject"/>
                    <field name="room_id"/>
                    <field name="start_time"/>
                    <field name="end_time"/>
                    <field name="state"/>
                    <field name="color"/>
                    <field name="expected_attendees"/>
                    <field name="organizer_id"/>
                    <field name="has_conflict"/>
                    
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_card oe_kanban_global_click #{record.has_conflict.raw_value ? 'o_kanban_record_danger' : ''}">
                                <div class="oe_kanban_content">
                                    <div class="o_kanban_record_top">
                                        <div class="o_kanban_record_headings">
                                            <strong class="o_kanban_record_title">
                                                <field name="subject"/>
                                            </strong>
                                        </div>
                                        <span t-if="record.has_conflict.raw_value" class="badge bg-danger">‚ö†Ô∏è</span>
                                    </div>
                                    <div class="o_kanban_record_body">
                                        <div><strong>üè¢</strong> <field name="room_id"/></div>
                                        <div><strong>üìÖ</strong> <field name="start_time"/></div>
                                        <div><strong>üë•</strong> <field name="expected_attendees"/> ng∆∞·ªùi</div>
                                    </div>
                                    <div class="o_kanban_record_bottom">
                                        <div class="oe_kanban_bottom_left">
                                            <field name="name" class="text-muted"/>
                                        </div>
                                        <div class="oe_kanban_bottom_right">
                                            <field name="organizer_id" widget="many2one_avatar_user"/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- ==================== CALENDAR VIEW ==================== -->
        <record id="view_meeting_room_booking_calendar_modern" model="ir.ui.view">
            <field name="name">meeting.room.booking.calendar.modern</field>
            <field name="model">meeting.room.booking</field>
            <field name="priority">5</field>
            <field name="arch" type="xml">
                <calendar string="L·ªãch ƒê·∫∑t Ph√≤ng" 
                          date_start="start_time" 
                          date_stop="end_time" 
                          color="room_id" 
                          mode="week"
                          quick_add="False"
                          event_open_popup="true">
                    <field name="subject"/>
                    <field name="room_id"/>
                    <field name="organizer_id"/>
                    <field name="expected_attendees"/>
                    <field name="state"/>
                </calendar>
            </field>
        </record>

        <!-- ==================== ACTION ƒê·∫∂T PH√íNG NHANH ==================== -->
        <record id="action_quick_booking" model="ir.actions.act_window">
            <field name="name">üöÄ ƒê·∫∑t Ph√≤ng Nhanh</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">meeting.room.booking</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="context">{
                'default_booker_id': uid,
                'default_organizer_id': uid
            }</field>
        </record>
    </data>
</odoo>
